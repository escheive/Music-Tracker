import{c as de,f as L,u as ke,o as Z,a as A,j as a,b as E,r as c,m as ae,d as x,e as Se,g as U,h as M,i as ye,k as De,l as qe,s as Ne,n as Le,p as ze,q as He,T as _,B as q,H as Oe,S as Be,t as se,F as O,I as J,L as Q,M as Ue,v as Ae,w as We,x as Ke,y as Ve,z as Ge,A as $e}from"./index-DPl9zu-i.js";import{u as Je}from"./fetch-DAvlDv-e.js";var[Qe,je]=de({name:"FormControlStylesContext",errorMessage:`useFormControlStyles returned is 'undefined'. Seems you forgot to wrap the components in "<FormControl />" `}),[Xe,K]=de({strict:!1,name:"FormControlContext"});function Ye(e){const{id:s,isRequired:o,isInvalid:t,isDisabled:n,isReadOnly:i,...m}=e,d=c.useId(),u=s||`field-${d}`,f=`${u}-label`,v=`${u}-feedback`,y=`${u}-helptext`,[P,C]=c.useState(!1),[k,j]=c.useState(!1),[h,R]=c.useState(!1),S=c.useCallback((b={},l=null)=>({id:y,...b,ref:ae(l,w=>{w&&j(!0)})}),[y]),I=c.useCallback((b={},l=null)=>({...b,ref:l,"data-focus":x(h),"data-disabled":x(n),"data-invalid":x(t),"data-readonly":x(i),id:b.id!==void 0?b.id:f,htmlFor:b.htmlFor!==void 0?b.htmlFor:u}),[u,n,h,t,i,f]),F=c.useCallback((b={},l=null)=>({id:v,...b,ref:ae(l,w=>{w&&C(!0)}),"aria-live":"polite"}),[v]),p=c.useCallback((b={},l=null)=>({...b,...m,ref:l,role:"group","data-focus":x(h),"data-disabled":x(n),"data-invalid":x(t),"data-readonly":x(i)}),[m,n,h,t,i]),r=c.useCallback((b={},l=null)=>({...b,ref:l,role:"presentation","aria-hidden":!0,children:b.children||"*"}),[]);return{isRequired:!!o,isInvalid:!!t,isReadOnly:!!i,isDisabled:!!n,isFocused:!!h,onFocus:()=>R(!0),onBlur:()=>R(!1),hasFeedbackText:P,setHasFeedbackText:C,hasHelpText:k,setHasHelpText:j,id:u,labelId:f,feedbackId:v,helpTextId:y,htmlProps:m,getHelpTextProps:S,getErrorMessageProps:F,getRootProps:p,getLabelProps:I,getRequiredIndicatorProps:r}}var Re=L(function(s,o){const t=ke("Form",s),n=Z(s),{getRootProps:i,htmlProps:m,...d}=Ye(n),u=A("chakra-form-control",s.className);return a.jsx(Xe,{value:d,children:a.jsx(Qe,{value:t,children:a.jsx(E.div,{...i({},o),className:u,__css:t.container})})})});Re.displayName="FormControl";var Ze=L(function(s,o){const t=K(),n=je(),i=A("chakra-form__helper-text",s.className);return a.jsx(E.div,{...t==null?void 0:t.getHelpTextProps(s,o),__css:n.helperText,className:i})});Ze.displayName="FormHelperText";var oe=L(function(s,o){var t;const n=Se("FormLabel",s),i=Z(s),{className:m,children:d,requiredIndicator:u=a.jsx(Ie,{}),optionalIndicator:f=null,...v}=i,y=K(),P=(t=y==null?void 0:y.getLabelProps(v,o))!=null?t:{ref:o,...v};return a.jsxs(E.label,{...P,className:A("chakra-form__label",i.className),__css:{display:"block",textAlign:"start",...n},children:[d,y!=null&&y.isRequired?u:f]})});oe.displayName="FormLabel";var Ie=L(function(s,o){const t=K(),n=je();if(!(t!=null&&t.isRequired))return null;const i=A("chakra-form__required-indicator",s.className);return a.jsx(E.span,{...t==null?void 0:t.getRequiredIndicatorProps(s,o),__css:n.requiredIndicator,className:i})});Ie.displayName="RequiredIndicator";function et(e){const{isDisabled:s,isInvalid:o,isReadOnly:t,isRequired:n,...i}=tt(e);return{...i,disabled:s,readOnly:t,required:n,"aria-invalid":U(o),"aria-required":U(n),"aria-readonly":U(t)}}function tt(e){var s,o,t;const n=K(),{id:i,disabled:m,readOnly:d,required:u,isRequired:f,isInvalid:v,isReadOnly:y,isDisabled:P,onFocus:C,onBlur:k,...j}=e,h=e["aria-describedby"]?[e["aria-describedby"]]:[];return n!=null&&n.hasFeedbackText&&(n!=null&&n.isInvalid)&&h.push(n.feedbackId),n!=null&&n.hasHelpText&&h.push(n.helpTextId),{...j,"aria-describedby":h.join(" ")||void 0,id:i??(n==null?void 0:n.id),isDisabled:(s=m??P)!=null?s:n==null?void 0:n.isDisabled,isReadOnly:(o=d??y)!=null?o:n==null?void 0:n.isReadOnly,isRequired:(t=u??f)!=null?t:n==null?void 0:n.isRequired,isInvalid:v??(n==null?void 0:n.isInvalid),onFocus:M(n==null?void 0:n.onFocus,C),onBlur:M(n==null?void 0:n.onBlur,k)}}var nt=()=>typeof document<"u",ge=!1,V=null,N=!1,re=!1,ie=new Set;function ce(e,s){ie.forEach(o=>o(e,s))}var st=typeof window<"u"&&window.navigator!=null?/^Mac/.test(window.navigator.platform):!1;function at(e){return!(e.metaKey||!st&&e.altKey||e.ctrlKey||e.key==="Control"||e.key==="Shift"||e.key==="Meta")}function xe(e){N=!0,at(e)&&(V="keyboard",ce("keyboard",e))}function B(e){if(V="pointer",e.type==="mousedown"||e.type==="pointerdown"){N=!0;const s=e.composedPath?e.composedPath()[0]:e.target;let o=!1;try{o=s.matches(":focus-visible")}catch{}if(o)return;ce("pointer",e)}}function ot(e){return e.mozInputSource===0&&e.isTrusted?!0:e.detail===0&&!e.pointerType}function rt(e){ot(e)&&(N=!0,V="virtual")}function it(e){e.target===window||e.target===document||(!N&&!re&&(V="virtual",ce("virtual",e)),N=!1,re=!1)}function lt(){N=!1,re=!0}function Ce(){return V!=="pointer"}function dt(){if(!nt()||ge)return;const{focus:e}=HTMLElement.prototype;HTMLElement.prototype.focus=function(...o){N=!0,e.apply(this,o)},document.addEventListener("keydown",xe,!0),document.addEventListener("keyup",xe,!0),document.addEventListener("click",rt,!0),window.addEventListener("focus",it,!0),window.addEventListener("blur",lt,!1),typeof PointerEvent<"u"?(document.addEventListener("pointerdown",B,!0),document.addEventListener("pointermove",B,!0),document.addEventListener("pointerup",B,!0)):(document.addEventListener("mousedown",B,!0),document.addEventListener("mousemove",B,!0),document.addEventListener("mouseup",B,!0)),ge=!0}function ct(e){dt(),e(Ce());const s=()=>e(Ce());return ie.add(s),()=>{ie.delete(s)}}function ut(e){return e&&ye(e)&&ye(e.target)}function mt(e={}){const{onChange:s,value:o,defaultValue:t,name:n,isDisabled:i,isFocusable:m,isNative:d,...u}=e,[f,v]=c.useState(t||""),y=typeof o<"u",P=y?o:f,C=c.useRef(null),k=c.useCallback(()=>{const p=C.current;if(!p)return;let r="input:not(:disabled):checked";const b=p.querySelector(r);if(b){b.focus();return}r="input:not(:disabled)";const l=p.querySelector(r);l==null||l.focus()},[]),h=`radio-${c.useId()}`,R=n||h,S=c.useCallback(p=>{const r=ut(p)?p.target.value:p;y||v(r),s==null||s(String(r))},[s,y]),I=c.useCallback((p={},r=null)=>({...p,ref:ae(r,C),role:"radiogroup"}),[]),F=c.useCallback((p={},r=null)=>({...p,ref:r,name:R,[d?"checked":"isChecked"]:P!=null?p.value===P:void 0,onChange(l){S(l)},"data-radiogroup":!0}),[d,R,S,P]);return{getRootProps:I,getRadioProps:F,name:R,ref:C,focus:k,setValue:v,value:P,onChange:S,isDisabled:i,isFocusable:m,htmlProps:u}}var[ft,Fe]=de({name:"RadioGroupContext",strict:!1}),we=L((e,s)=>{const{colorScheme:o,size:t,variant:n,children:i,className:m,isDisabled:d,isFocusable:u,...f}=e,{value:v,onChange:y,getRootProps:P,name:C,htmlProps:k}=mt(f),j=c.useMemo(()=>({name:C,size:t,onChange:y,colorScheme:o,value:v,variant:n,isDisabled:d,isFocusable:u}),[C,t,y,o,v,n,d,u]);return a.jsx(ft,{value:j,children:a.jsx(E.div,{...P(k,s),className:A("chakra-radio-group",m),children:i})})});we.displayName="RadioGroup";var ht={border:"0",clip:"rect(0, 0, 0, 0)",height:"1px",width:"1px",margin:"-1px",padding:"0",overflow:"hidden",whiteSpace:"nowrap",position:"absolute"};function pt(e={}){const{defaultChecked:s,isChecked:o,isFocusable:t,isDisabled:n,isReadOnly:i,isRequired:m,onChange:d,isInvalid:u,name:f,value:v,id:y,"data-radiogroup":P,"aria-describedby":C,...k}=e,j=`radio-${c.useId()}`,h=K(),S=!!Fe()||!!P;let F=!!h&&!S?h.id:j;F=y??F;const p=n??(h==null?void 0:h.isDisabled),r=i??(h==null?void 0:h.isReadOnly),b=m??(h==null?void 0:h.isRequired),l=u??(h==null?void 0:h.isInvalid),[w,ee]=c.useState(!1),[z,G]=c.useState(!1),[W,$]=c.useState(!1),[te,H]=c.useState(!1),[Me,Ee]=c.useState(!!s),ne=typeof o<"u",T=ne?o:Me;c.useEffect(()=>ct(ee),[]);const ue=c.useCallback(g=>{if(r||p){g.preventDefault();return}ne||Ee(g.target.checked),d==null||d(g)},[ne,p,r,d]),me=c.useCallback(g=>{g.key===" "&&H(!0)},[H]),fe=c.useCallback(g=>{g.key===" "&&H(!1)},[H]),he=c.useCallback((g={},D=null)=>({...g,ref:D,"data-active":x(te),"data-hover":x(W),"data-disabled":x(p),"data-invalid":x(l),"data-checked":x(T),"data-focus":x(z),"data-focus-visible":x(z&&w),"data-readonly":x(r),"aria-hidden":!0,onMouseDown:M(g.onMouseDown,()=>H(!0)),onMouseUp:M(g.onMouseUp,()=>H(!1)),onMouseEnter:M(g.onMouseEnter,()=>$(!0)),onMouseLeave:M(g.onMouseLeave,()=>$(!1))}),[te,W,p,l,T,z,r,w]),{onFocus:pe,onBlur:be}=h??{},Te=c.useCallback((g={},D=null)=>{const ve=p&&!t;return{...g,id:F,ref:D,type:"radio",name:f,value:v,onChange:M(g.onChange,ue),onBlur:M(be,g.onBlur,()=>G(!1)),onFocus:M(pe,g.onFocus,()=>G(!0)),onKeyDown:M(g.onKeyDown,me),onKeyUp:M(g.onKeyUp,fe),checked:T,disabled:ve,readOnly:r,required:b,"aria-invalid":U(l),"aria-disabled":U(ve),"aria-required":U(b),"data-readonly":x(r),"aria-describedby":C,style:ht}},[p,t,F,f,v,ue,be,pe,me,fe,T,r,b,l,C]);return{state:{isInvalid:l,isFocused:z,isChecked:T,isActive:te,isHovered:W,isDisabled:p,isReadOnly:r,isRequired:b},getCheckboxProps:he,getRadioProps:he,getInputProps:Te,getLabelProps:(g={},D=null)=>({...g,ref:D,onMouseDown:M(g.onMouseDown,bt),"data-disabled":x(p),"data-checked":x(T),"data-invalid":x(l)}),getRootProps:(g,D=null)=>({...g,ref:D,"data-disabled":x(p),"data-checked":x(T),"data-invalid":x(l)}),htmlProps:k}}function bt(e){e.preventDefault(),e.stopPropagation()}function vt(e,s){const o={},t={};for(const[n,i]of Object.entries(e))s.includes(n)?o[n]=i:t[n]=i;return[o,t]}var Y=L((e,s)=>{var o;const t=Fe(),{onChange:n,value:i}=e,m=ke("Radio",{...t,...e}),d=Z(e),{spacing:u="0.5rem",children:f,isDisabled:v=t==null?void 0:t.isDisabled,isFocusable:y=t==null?void 0:t.isFocusable,inputProps:P,...C}=d;let k=e.isChecked;(t==null?void 0:t.value)!=null&&i!=null&&(k=t.value===i);let j=n;t!=null&&t.onChange&&i!=null&&(j=De(t.onChange,n));const h=(o=e==null?void 0:e.name)!=null?o:t==null?void 0:t.name,{getInputProps:R,getCheckboxProps:S,getLabelProps:I,getRootProps:F,htmlProps:p}=pt({...C,isChecked:k,isFocusable:y,isDisabled:v,onChange:j,name:h}),[r,b]=vt(p,qe),l=S(b),w=R(P,s),ee=I(),z=Object.assign({},r,F()),G={display:"inline-flex",alignItems:"center",verticalAlign:"top",cursor:"pointer",position:"relative",...m.container},W={display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,...m.control},$={userSelect:"none",marginStart:u,...m.label};return a.jsxs(E.label,{className:"chakra-radio",...z,__css:G,children:[a.jsx("input",{className:"chakra-radio__input",...w}),a.jsx(E.span,{className:"chakra-radio__control",...l,__css:W}),f&&a.jsx(E.span,{className:"chakra-radio__label",...ee,__css:$,children:f})]})});Y.displayName="Radio";function yt(e,s=[]){const o=Object.assign({},e);for(const t of s)t in o&&delete o[t];return o}var gt=["h","minH","height","minHeight"],_e=L((e,s)=>{const o=Se("Textarea",e),{className:t,rows:n,...i}=Z(e),m=et(i),d=n?yt(o,gt):o;return a.jsx(E.textarea,{ref:s,rows:n,...m,className:A("chakra-textarea",t),__css:d})});_e.displayName="Textarea";const xt=e=>e.slice(0,10).map(s=>({id:s.id,name:s.name,artist:s.artists[0].name,imageUrl:s.album.images[0].url,spotifyUrl:s.external_urls.spotify})),Ct=e=>{const s=e.artists.items.slice(0,5).map(t=>{var n;return{id:t.id,name:t.name,imageUrl:(n=t.images[0])==null?void 0:n.url,spotifyUrl:t.external_urls.spotify}}),o=e.tracks.items.slice(0,5).map(t=>{var n;return{id:t.id,name:t.name,imageUrl:(n=t.album.images[0])==null?void 0:n.url,spotifyUrl:t.external_urls.spotify}});return{artists:s,tracks:o}},Pt=async e=>{let{user_id:s,type:o,content:t,metadata:n}=e;o==="recentlyPlayed"?n=xt(n):o==="topItems"&&(n=Ct(n));const{error:i}=await Ne.from("Posts").insert([{user_id:s,type:o,content:t,metadata:n}]).select();return i};var le=new Map,X=new WeakMap,Pe=0,kt=void 0;function St(e){return e?(X.has(e)||(Pe+=1,X.set(e,Pe.toString())),X.get(e)):"0"}function jt(e){return Object.keys(e).sort().filter(s=>e[s]!==void 0).map(s=>`${s}_${s==="root"?St(e.root):e[s]}`).toString()}function Rt(e){const s=jt(e);let o=le.get(s);if(!o){const t=new Map;let n;const i=new IntersectionObserver(m=>{m.forEach(d=>{var u;const f=d.isIntersecting&&n.some(v=>d.intersectionRatio>=v);e.trackVisibility&&typeof d.isVisible>"u"&&(d.isVisible=f),(u=t.get(d.target))==null||u.forEach(v=>{v(f,d)})})},e);n=i.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),o={id:s,observer:i,elements:t},le.set(s,o)}return o}function It(e,s,o={},t=kt){if(typeof window.IntersectionObserver>"u"&&t!==void 0){const u=e.getBoundingClientRect();return s(t,{isIntersecting:t,target:e,intersectionRatio:typeof o.threshold=="number"?o.threshold:0,time:0,boundingClientRect:u,intersectionRect:u,rootBounds:u}),()=>{}}const{id:n,observer:i,elements:m}=Rt(o),d=m.get(e)||[];return m.has(e)||m.set(e,d),d.push(s),i.observe(e),function(){d.splice(d.indexOf(s),1),d.length===0&&(m.delete(e),i.unobserve(e)),m.size===0&&(i.disconnect(),le.delete(n))}}function Ft({threshold:e,delay:s,trackVisibility:o,rootMargin:t,root:n,triggerOnce:i,skip:m,initialInView:d,fallbackInView:u,onChange:f}={}){var v;const[y,P]=c.useState(null),C=c.useRef(),[k,j]=c.useState({inView:!!d,entry:void 0});C.current=f,c.useEffect(()=>{if(m||!y)return;let I;return I=It(y,(F,p)=>{j({inView:F,entry:p}),C.current&&C.current(F,p),p.isIntersecting&&i&&I&&(I(),I=void 0)},{root:n,rootMargin:t,threshold:e,trackVisibility:o,delay:s},u),()=>{I&&I()}},[Array.isArray(e)?e.toString():e,y,n,t,i,m,o,u,s]);const h=(v=k.entry)==null?void 0:v.target,R=c.useRef();!y&&h&&!i&&!m&&R.current!==h&&(R.current=h,j({inView:!!d,entry:void 0}));const S=[P,k.inView,k.entry];return S.ref=S[0],S.inView=S[1],S.entry=S[2],S}const Dt=()=>{const{session:e}=Le(),{data:s}=ze(),{data:o}=He(),[t,n]=c.useState({user_id:e==null?void 0:e.user.id,type:"general",content:"",metadata:null}),[i,m]=c.useState(!1),[d,u]=c.useState(null),{data:f,size:v,setSize:y,error:P}=Je(),{ref:C,inView:k}=Ft(),[j,h]=c.useState(!0),R=f?f.flat():[];if(c.useEffect(()=>{k&&j&&f&&f.length>0&&y(v+1)},[k]),c.useEffect(()=>{f&&f[f.length-1]&&f[f.length-1].length<10&&h(!1)},[f]),P)return a.jsx(_,{children:"Error fetching posts"});const S=r=>{u(r),m(!0)},I=()=>{u(null),m(!1)},F=r=>{const{name:b,value:l}="target"in r?r.target:{name:"type",value:r};n(w=>({...w,[b]:l}))},p=()=>{let r;t.type=="recentlyPlayed"?r=s:t.type=="topItems"&&(r=o),Pt({...t,metadata:r}),n({user_id:e==null?void 0:e.user.id,type:"general",content:"",metadata:null})};return a.jsxs(q,{display:"flex",flexDirection:"column",alignItems:"center",marginBlock:"5%",children:[a.jsx(Oe,{children:"Music Tracker for Spotify"}),a.jsxs(q,{width:"100%",maxW:"600px",mx:"auto",mt:4,p:4,children:[a.jsxs(Re,{id:"post",children:[a.jsx(oe,{children:"What's on your mind?"}),a.jsx(_e,{name:"content",value:t.content,onChange:F,placeholder:"Type your post here...",size:"md",resize:"vertical"})]}),a.jsx(oe,{children:"Share what you're listening to!"}),a.jsx(we,{name:"type",value:t.type,onChange:F,children:a.jsxs(Be,{spacing:5,direction:"row",children:[a.jsx(Y,{colorScheme:"green",name:"type",value:"general",children:"No thanks"}),a.jsx(Y,{colorScheme:"green",name:"type",value:"recentlyPlayed",children:"Recently Played Songs"}),a.jsx(Y,{colorScheme:"green",value:"topItems",children:"Top Tracks and Artists"})]})}),a.jsx(se,{mt:4,onClick:p,children:"Post"})]}),a.jsxs(q,{flexDirection:"column",width:["100%","80%"],children:[R==null?void 0:R.map(r=>{const b=new Date(r.created_at).toLocaleString();return a.jsxs(q,{p:4,mb:6,bg:"white",boxShadow:"md",borderRadius:"md",children:[a.jsxs(O,{mb:2,alignItems:"center",children:[a.jsx(_,{fontSize:"lg",paddingRight:2,fontWeight:"semibold",children:r.user.username}),a.jsx(_,{fontSize:"sm",fontWeight:"semibold",children:b})]}),a.jsx(_,{fontSize:"md",fontWeight:"semibold",mb:3,children:r.content}),r.type!=="general"?a.jsx(q,{p:[1,4],mb:[3,6],bg:"alternatePurple.50",boxShadow:"sm",borderRadius:"md",children:r.type=="recentlyPlayed"?a.jsxs(a.Fragment,{children:[a.jsx(_,{fontSize:"md",fontWeight:"semibold",children:"Recently Played Songs:"}),r==null?void 0:r.metadata.slice(0,3).map((l,w)=>a.jsxs(O,{alignItems:"center",mb:2,children:[a.jsx(J,{src:l.imageUrl,alt:l.name,boxSize:"40px",borderRadius:"md",mr:3}),a.jsx(Q,{href:l.spotifyUrl,target:"_blank",children:a.jsx(_,{fontSize:["sm","md"],children:l.name})})]},w+l.id)),a.jsx(se,{variant:"solid",onClick:()=>S(r),children:"View More"})]}):r.type==="topItems"?a.jsx(a.Fragment,{children:a.jsxs(O,{children:[a.jsxs(q,{flex:"1",mr:4,children:[a.jsx(_,{fontSize:"lg",fontWeight:"semibold",mb:2,children:"My Top Artists"}),r==null?void 0:r.metadata.artists.map((l,w)=>a.jsxs(O,{alignItems:"center",mb:2,children:[a.jsx(J,{src:l.imageUrl,alt:l.name,boxSize:"40px",borderRadius:"md",mr:3}),a.jsx(Q,{href:l.spotifyUrl,target:"_blank",children:a.jsx(_,{fontSize:["sm","md"],children:l.name})})]},w+l.id))]}),a.jsxs(q,{flex:"1",children:[a.jsx(_,{fontSize:"lg",fontWeight:"semibold",mb:2,children:"My Top Tracks"}),r==null?void 0:r.metadata.tracks.map((l,w)=>a.jsxs(O,{alignItems:"center",mb:2,children:[a.jsx(J,{src:l.imageUrl,alt:l.name,boxSize:"40px",borderRadius:"md",mr:3}),a.jsx(Q,{href:l.spotifyUrl,target:"_blank",children:a.jsx(_,{fontSize:["sm","md"],children:l.name})})]},w+l.id))]})]})}):null}):null]},r.id)}),a.jsx("div",{ref:C})]}),d&&a.jsxs(Ue,{isOpen:i,onClose:I,size:"xl",children:[a.jsx(Ae,{}),a.jsxs(We,{children:[a.jsx(Ke,{children:"Recently Played Songs"}),a.jsx(Ve,{color:"alternatePurple.300"}),a.jsx(Ge,{children:d==null?void 0:d.metadata.map((r,b)=>a.jsxs(O,{alignItems:"center",mb:2,children:[a.jsx(J,{src:r.imageUrl,alt:r.name,boxSize:"40px",borderRadius:"md",mr:3}),a.jsxs(Q,{href:r.spotifyUrl,target:"_blank",children:[a.jsx(_,{fontSize:"sm",fontWeight:"semibold",children:r.name}),a.jsx(_,{fontSize:"sm",children:r.artist})]})]},b+r.id+"modal"))}),a.jsx($e,{children:a.jsx(se,{backgroundColor:"alternatePurple.200",onClick:I,children:"Close"})})]})]})]})};export{Dt as DashboardRoute};
