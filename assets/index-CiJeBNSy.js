import{r as E,j as i,S as L,F as O,h as T,i as z,B as F,H as w}from"./index-BaKXglnC.js";import{i as D,c as I,l as W,s as B,a as V,L as Z}from"./LineChart-CtNX8ozV.js";class C extends Map{constructor(e,n=N){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[a,s]of e)this.set(a,s)}get(e){return super.get(b(this,e))}has(e){return super.has(b(this,e))}set(e,n){return super.set(q(this,e),n)}delete(e){return super.delete(G(this,e))}}function b({_intern:t,_key:e},n){const a=e(n);return t.has(a)?t.get(a):n}function q({_intern:t,_key:e},n){const a=e(n);return t.has(a)?t.get(a):(t.set(a,n),n)}function G({_intern:t,_key:e},n){const a=e(n);return t.has(a)&&(n=t.get(a),t.delete(a)),n}function N(t){return t!==null&&typeof t=="object"?t.valueOf():t}const A=Symbol("implicit");function R(){var t=new C,e=[],n=[],a=A;function s(o){let g=t.get(o);if(g===void 0){if(a!==A)return a;t.set(o,g=e.push(o)-1)}return n[g%n.length]}return s.domain=function(o){if(!arguments.length)return e.slice();e=[],t=new C;for(const g of o)t.has(g)||t.set(g,e.push(g)-1);return s},s.range=function(o){return arguments.length?(n=Array.from(o),s):n.slice()},s.unknown=function(o){return arguments.length?(a=o,s):a},s.copy=function(){return R(e,n).unknown(a)},D.apply(s,arguments),s}function J(t){for(var e=t.length/6|0,n=new Array(e),a=0;a<e;)n[a]="#"+t.slice(a*6,++a*6);return n}const K=J("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");var Q=P(I);function $(t){this._curve=t}$.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}};function P(t){function e(n){return new $(t(n))}return e._curve=t,e}function U(t){var e=t.curve;return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t.curve=function(n){return arguments.length?e(P(n)):e()._curve},t}function X(){return U(W().curve(Q))}const Y=({data:t,width:e=540,height:n=540,centerX:a=e/2,centerY:s=n/2,radius:o=Math.min(e,n)/2-60,maxRadius:g=270,categories:p})=>{const l=E.useRef(null);E.useEffect(()=>{d()},[t]);const d=()=>{const c=B(l.current);c.selectAll("*").remove(),R().domain(p).range(K);const r=V().domain([0,p.length]).range([0,Math.PI*2]),M=X().angle((m,u)=>r(u)).radius(m=>Math.min(o,g*m))(t)+"Z";c.append("g").attr("transform",`translate(${a}, ${s})`).selectAll("path").data(t).enter().append("path").attr("fill","pink").attr("stroke-width",2).attr("d",M),c.append("g").attr("transform",`translate(${a}, ${s})`).selectAll("text").data(p).enter().append("text").text(m=>m).attr("x",(m,u)=>(o+30)*Math.cos(r(u-1))).attr("y",(m,u)=>(o+10)*Math.sin(r(u-1))).attr("text-anchor","middle").attr("alignment-baseline","middle").style("font-size","12px").style("font-weight","bold");const S=c.append("path").attr("fill","none").attr("stroke","black").attr("stroke-width",2),f=p.map((m,u)=>{const h=a+o*Math.cos(r(u-1)),y=s+o*Math.sin(r(u-1));return`${h},${y}`});S.attr("d",`M${f.join("L")}Z`),c.append("circle").attr("cx",a).attr("cy",s).attr("r",1).attr("fill","black"),c.selectAll(".cross-line").data(p).enter().append("line").attr("class","cross-line").attr("x1",a).attr("y1",s).attr("x2",(m,u)=>{const h=r(u-1);return a+o*Math.cos(h)}).attr("y2",(m,u)=>{const h=r(u-1);return s+o*Math.sin(h)}).attr("stroke","gray").attr("stroke-width",1);const k=p.map((m,u)=>{const h=r(u-1),y=a+o/2*Math.cos(h),x=s+o/2*Math.sin(h);return`${y},${x}`});c.append("path").attr("fill","none").attr("stroke","gray").attr("stroke-width",1).attr("d",`M${k.join("L")}Z`)};return i.jsx(L,{children:i.jsx("svg",{ref:l,width:e,height:n})})},H=["Happiness","Energetic","Sadness","Calm"],tt=50,et=({value:t,max:e,min:n})=>n===e?0:(Math.max(n,Math.min(t,e))-n)/(e-n),nt=({recentlyPlayedSongs:t})=>{const e=p=>{const l=H.map(c=>p[c]/tt),d=Math.max(...l);if(d>1){const c=1/d;return l.map(r=>r*c)}return l},n=p=>{const{acousticness:l,energy:d,tempo:c,valence:r}=p,v=.5,M=.5,S=.5,f=.4,k=.1,_=90,m=120,u=et({value:c,max:1,min:0});let h=0,y=0,x=0,j=0;return r>.7?h+=r*M:(r<.3||(h+=r*M),y+=(1-r)*M),d>.7?(h+=d*v,j+=d*S):d<.3?(y+=(1-d)*v,x+=(1-d)*S):(h+=d*v,y+=(1-d)*v,j+=d*S,x+=(1-d)*S),h=Math.min(1,Math.max(0,h)),y=Math.min(1,Math.max(0,y)),c>m?j+=u*f:(c<_||(j+=u*f),x+=(1-u)*f),l>.7?x+=l*k:(l<.3||(x+=l*k),j+=(1-l)*k),x=Math.min(1,Math.max(0,x)),j=Math.min(1,Math.max(0,j)),{happyScore:h,sadScore:y,calmScore:x,energeticScore:j}},a=()=>{const p={Happiness:0,Sadness:0,Calm:0,Energetic:0},l={};t.forEach(c=>{if(c.tempo){const{happyScore:r,sadScore:v,calmScore:M,energeticScore:S}=n(c);p.Happiness+=r,p.Sadness+=v,p.Calm+=M,p.Energetic+=S;const f=c.played_at.split("T")[0];l[f]||(l[f]={Happiness:0,Sadness:0,Calm:0,Energetic:0,count:0}),l[f].Happiness+=r-v,l[f].Energetic+=S-M,l[f].count+=1}});const d=Object.entries(l).map(([c,r])=>({date:c,Happiness:r.Happiness/r.count,Energetic:r.Energetic/r.count}));return{totalMoodScores:p,dailyMoodScores:d}},{totalMoodScores:s,dailyMoodScores:o}=a(),g=e(s);return i.jsxs(O,{children:[i.jsx(Y,{data:g,categories:H}),i.jsx(Z,{title:"Mood Over Time",data:o,description:"A display of your mood over the past 10 days."})]})},st=()=>{const t=T(),{user:e,userMutate:n,loggedOut:a,recentlyPlayedSongs:s,recentlyPlayedSongsIsLoading:o}=z();return E.useEffect(()=>{a&&n(null,!1).then(()=>t("/"))},[a,n]),i.jsx(i.Fragment,{children:i.jsxs(F,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",children:[i.jsx(w,{children:"Music Tracker"}),e?i.jsxs(i.Fragment,{children:[i.jsx(w,{children:e.display_name}),i.jsxs("p",{children:["Email: ",e.email]}),i.jsxs("p",{children:["Country: ",e.country]}),i.jsxs("p",{children:["Product: ",e.product]}),i.jsxs("p",{children:["Type: ",e.type]}),i.jsxs("p",{children:["Followers: ",e.followers.total]}),i.jsx("a",{href:e.external_urls.spotify,target:"blank",children:"Open on Spotify"})]}):null,o?null:i.jsx(i.Fragment,{children:i.jsx(nt,{recentlyPlayedSongs:s})})]})})};export{st as Mood};
