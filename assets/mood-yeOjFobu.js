import{r as w,j as d,ai as L,B as A,C as O,D as z,p as B,H as D}from"./index-DPl9zu-i.js";import{i as I,c as T,l as W,s as F,a as V,L as Z}from"./LineChart-VWWycjCL.js";class _ extends Map{constructor(e,n=N){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:n}}),e!=null)for(const[a,s]of e)this.set(a,s)}get(e){return super.get(C(this,e))}has(e){return super.has(C(this,e))}set(e,n){return super.set(q(this,e),n)}delete(e){return super.delete(G(this,e))}}function C({_intern:t,_key:e},n){const a=e(n);return t.has(a)?t.get(a):n}function q({_intern:t,_key:e},n){const a=e(n);return t.has(a)?t.get(a):(t.set(a,n),n)}function G({_intern:t,_key:e},n){const a=e(n);return t.has(a)&&(n=t.get(a),t.delete(a)),n}function N(t){return t!==null&&typeof t=="object"?t.valueOf():t}const b=Symbol("implicit");function H(){var t=new _,e=[],n=[],a=b;function s(o){let f=t.get(o);if(f===void 0){if(a!==b)return a;t.set(o,f=e.push(o)-1)}return n[f%n.length]}return s.domain=function(o){if(!arguments.length)return e.slice();e=[],t=new _;for(const f of o)t.has(f)||t.set(f,e.push(f)-1);return s},s.range=function(o){return arguments.length?(n=Array.from(o),s):n.slice()},s.unknown=function(o){return arguments.length?(a=o,s):a},s.copy=function(){return H(e,n).unknown(a)},I.apply(s,arguments),s}function U(t){for(var e=t.length/6|0,n=new Array(e),a=0;a<e;)n[a]="#"+t.slice(a*6,++a*6);return n}const J=U("1f77b4ff7f0e2ca02cd627289467bd8c564be377c27f7f7fbcbd2217becf");var K=$(T);function P(t){this._curve=t}P.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(t,e){this._curve.point(e*Math.sin(t),e*-Math.cos(t))}};function $(t){function e(n){return new P(t(n))}return e._curve=t,e}function Q(t){var e=t.curve;return t.angle=t.x,delete t.x,t.radius=t.y,delete t.y,t.curve=function(n){return arguments.length?e($(n)):e()._curve},t}function X(){return Q(W().curve(K))}const Y=({data:t,width:e=540,height:n=540,centerX:a=e/2,centerY:s=n/2,radius:o=Math.min(e,n)/2-60,maxRadius:f=270,categories:p})=>{const c=w.useRef(null);w.useEffect(()=>{u()},[t]);const u=()=>{const i=F(c.current);i.selectAll("*").remove(),H().domain(p).range(J);const r=V().domain([0,p.length]).range([0,Math.PI*2]),M=X().angle((m,l)=>r(l)).radius(m=>Math.min(o,f*m))(t)+"Z";i.append("g").attr("transform",`translate(${a}, ${s})`).selectAll("path").data(t).enter().append("path").attr("fill","pink").attr("stroke-width",2).attr("d",M),i.append("g").attr("transform",`translate(${a}, ${s})`).selectAll("text").data(p).enter().append("text").text(m=>m).attr("x",(m,l)=>(o+30)*Math.cos(r(l-1))).attr("y",(m,l)=>(o+10)*Math.sin(r(l-1))).attr("text-anchor","middle").attr("alignment-baseline","middle").style("font-size","12px").style("font-weight","bold");const S=i.append("path").attr("fill","none").attr("stroke","black").attr("stroke-width",2),g=p.map((m,l)=>{const h=a+o*Math.cos(r(l-1)),y=s+o*Math.sin(r(l-1));return`${h},${y}`});S.attr("d",`M${g.join("L")}Z`),i.append("circle").attr("cx",a).attr("cy",s).attr("r",1).attr("fill","black"),i.selectAll(".cross-line").data(p).enter().append("line").attr("class","cross-line").attr("x1",a).attr("y1",s).attr("x2",(m,l)=>{const h=r(l-1);return a+o*Math.cos(h)}).attr("y2",(m,l)=>{const h=r(l-1);return s+o*Math.sin(h)}).attr("stroke","gray").attr("stroke-width",1);const j=p.map((m,l)=>{const h=r(l-1),y=a+o/2*Math.cos(h),x=s+o/2*Math.sin(h);return`${y},${x}`});i.append("path").attr("fill","none").attr("stroke","gray").attr("stroke-width",1).attr("d",`M${j.join("L")}Z`)};return d.jsx(L,{paddingInline:"20%",children:d.jsx("svg",{ref:c,viewBox:"0, 0, 540, 540"})})},R=["Happiness","Energetic","Sadness","Calm"],tt=50,et=({value:t,max:e,min:n})=>n===e?0:(Math.max(n,Math.min(t,e))-n)/(e-n),nt=({recentlyPlayedSongs:t})=>{const e=p=>{const c=R.map(i=>p[i]/tt),u=Math.max(...c);if(u>1){const i=1/u;return c.map(r=>r*i)}return c},n=p=>{const{acousticness:c,energy:u,tempo:i,valence:r}=p,k=.5,M=.5,S=.5,g=.4,j=.1,E=90,m=120,l=et({value:i,max:1,min:0});let h=0,y=0,x=0,v=0;return r>.7?h+=r*M:(r<.3||(h+=r*M),y+=(1-r)*M),u>.7?(h+=u*k,v+=u*S):u<.3?(y+=(1-u)*k,x+=(1-u)*S):(h+=u*k,y+=(1-u)*k,v+=u*S,x+=(1-u)*S),h=Math.min(1,Math.max(0,h)),y=Math.min(1,Math.max(0,y)),i>m?v+=l*g:(i<E||(v+=l*g),x+=(1-l)*g),c>.7?x+=c*j:(c<.3||(x+=c*j),v+=(1-c)*j),x=Math.min(1,Math.max(0,x)),v=Math.min(1,Math.max(0,v)),{happyScore:h,sadScore:y,calmScore:x,energeticScore:v}},a=()=>{const p={Happiness:0,Sadness:0,Calm:0,Energetic:0},c={};t.forEach(i=>{if(i.tempo){const{happyScore:r,sadScore:k,calmScore:M,energeticScore:S}=n(i);p.Happiness+=r,p.Sadness+=k,p.Calm+=M,p.Energetic+=S;const g=i.played_at.split("T")[0];c[g]||(c[g]={Happiness:0,Sadness:0,Calm:0,Energetic:0,count:0}),c[g].Happiness+=r-k,c[g].Energetic+=S-M,c[g].count+=1}});const u=Object.entries(c).map(([i,r])=>({date:i,Happiness:r.Happiness/r.count,Energetic:r.Energetic/r.count}));return{totalMoodScores:p,dailyMoodScores:u}},{totalMoodScores:s,dailyMoodScores:o}=a(),f=e(s);return d.jsxs(A,{width:"100%",padding:"5%",children:[d.jsx(Y,{data:f,categories:R}),d.jsx(Z,{title:"Mood Over Time",data:o,description:"A display of your mood over the past 10 days."})]})},st=()=>{const t=O(),{user:e,userMutate:n,loggedOut:a}=z(),{data:s,isLoading:o}=B();return w.useEffect(()=>{let f=!0;if(a)return n(null,!1).then(()=>{f&&t("/")}),()=>{f=!1}},[a,n,t]),d.jsx(d.Fragment,{children:d.jsxs(A,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",marginBlock:"5%",children:[e?d.jsxs(d.Fragment,{children:[d.jsx(D,{children:e.display_name}),d.jsxs("p",{children:["Product: ",e.product]}),d.jsxs("p",{children:["Followers: ",e.followers.total]}),d.jsx("a",{href:e.external_urls.spotify,target:"blank",children:"Open on Spotify"})]}):null,o?null:d.jsx(d.Fragment,{children:d.jsx(nt,{recentlyPlayedSongs:s})})]})})};export{st as ProfileMoodRoute};
